---
title: "R Notebook"
output: html_notebook
---

# Import Libraries
```{r}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(here)
library(hrbrthemes)
library(gapminder)
library(viridis)
library(RColorBrewer)
```

# Import Datasets

```{r}
eruptions <- read_csv(here("data/clean_data/eruptions.csv"))
commented_events <- read_csv(here("data/clean_data/commented_events.csv"))
events <- read_csv(here("data/clean_data/events.csv"))
sulfur <- read_csv(here("data/clean_data/sulfur.csv"))
tree_rings <- read_csv(here("data/clean_data/tree_rings.csv"))
volcanoes <- read_csv(here("data/clean_data/volcanoes.csv"))
vei_scale <- read_csv(here("data/clean_data/vei_scale.csv"))
```

# Split the volcanoes by VEI

```{r}
# Count number of eruptions by VEI
eruptions %>% 
  group_by(vei) %>% 
  summarise(count = n())
```

```{r}
# Add the volcano detail onto the eruption database
eruptions_volc <- left_join(eruptions, volcanoes, by = "volcano_name")
```

```{r}
# Remove duplicate columns
eruptions_volc = 
  select(eruptions_volc, -volcano_number.y, -latitude.y, -longitude.y)
```

```{r}
# Rename columns
eruptions_volc = 
rename(eruptions_volc, volcano_number = volcano_number.x)

eruptions_volc = 
rename(eruptions_volc, latitude = latitude.x)

eruptions_volc = 
rename(eruptions_volc, longitude = longitude.x)

```

```{r}
# Create dataset with just recorded vei values
vei_0_7 <- eruptions_volc %>% drop_na(vei)
```

```{r}
# Count number of eruptions by VEI
count_vei <- vei_0_7 %>% 
  group_by(vei) %>% 
  summarise(count = n())
count_vei
```

```{r}
# change the VEI to a factor
vei_0_7 <- vei_0_7 %>% 
  mutate(vei = as.factor(vei))
```

```{r}
ggplot(vei_0_7, aes(x=vei, fill = vei)) +  
  geom_bar( ) +
  scale_fill_manual(values =  c("0" = "cornsilk", "1" = "gold1", "2" = "darkgoldenrod2",
          "3" = "darkorange2", "4" = "firebrick1", "5" = "firebrick", "6" = "firebrick4",
          "7" = "black")) +
    labs(
      x = "VEI - Volcanic Explosivity Index",
      y = "Number of Eruptions",
      title = "Number of Eruptions by VEI"
      ) 
```



```{r}
vei_0_7 %>% 
ggplot(aes(x=start_year, y=elevation, colour=vei)) + 
    geom_point(size=2) +
    scale_colour_manual(values =  c("0" = "cornsilk", "1" = "gold1", "2" = "darkgoldenrod2",
          "3" = "darkorange2", "4" = "firebrick1", "5" = "firebrick", "6" = "firebrick4",
          "7" = "black")) +
    labs(
      x = "Year of eruption",
      y = "Elevation (metres)",
      title = "Number of Eruptions by Year and Elevation",
      subtitle = "Using VEI scale"
      ) 


```

But what is going on here - it looks like some volcanoes are erupting many times.

Let's have a look.

```{r}
vei_0_7 %>% 
  group_by(volcano_number.x)
```


```{r}
# Most basic bubble plot
ggplot(vei_0_7, aes(x=latitude.x, y=longitude.x, size = population_within_5_km, colour = vei)) +
    geom_point(alpha=0.7)
```


```{r}
vei_0_7 %>% 
  ggplot(aes(x=vei)) +
    geom_histogram() +
    facet_wrap(~primary_volcano_type)
```

```{r}
vei_0_7 %>% 
  ggplot(aes(x=vei)) +
    geom_histogram() +
    facet_wrap(~region)
```

```{r}
vei_0_7 %>% 
  ggplot(aes(x=population_within_30_km, y = vei)) +
    geom_point() 
```

```{r}
vei_0_7 %>% 
  ggplot(aes(x=start_year, y = population_within_100_km, colour = vei)) +
    geom_point() 
```


# Population near Volcanoes

We know the population within 5, 10, 30 and 100km
We know the last time a volcano blew
We know what the VEI of the last eruption.

If we assume that a volcan eruption will be at least the same as the previous eruption where is the biggest population at risk?

```{r}
# Match the VEI information into the volcano dataset
volcanoes_vei <- left_join(vei_0_7, vei_scale, by = "vei") 

```




```{r}
 
ggplot(vei_1_7, 
       aes(x=weight)) + geom_histogram()
    
  
  

ggplot(df, aes(x=weight)) + geom_histogram()
# Change the width of bins
ggplot(df, aes(x=weight)) + 
  geom_histogram(binwidth=1)
# Change colors
p<-ggplot(df, aes(x=weight)) + 
  geom_histogram(color="black", fill="white")
p
```




